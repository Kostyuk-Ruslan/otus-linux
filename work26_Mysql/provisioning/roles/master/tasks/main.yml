---

  - name: "Add Percona yum repository"
    yum:
      name: https://repo.percona.com/yum/percona-release-latest.noarch.rpm
      state: present
 


  

  - name: Add multiple repositories 
    yum_repository:
      name: epel
      description: EPEL YUM repo
      file: external_repos
      baseurl: https://download.fedoraproject.org/pub/epel/$releasever/$basearch/
      gpgcheck: no


  - name: install epel-release
    yum:
     name:
      - epel-release
     state: latest
    tags: install-packages


  - name: Disable SELinux
    selinux:
      state: disabled


  - name: stop and disable firewalld
    systemd:
      name: firewalld
      state: stopped
      enabled: no


  - name: install package
    yum:
     name:
      - net-tools
      - vim
      - zip
      - unzip
      - traceroute
      - mtr
      - mc
      - tcpdump
      - Percona-Server-server-57
      - python3-PyMySQL
      - python3
      - MySQL-python





# - name: Copy conf mysql
#    copy:
#      src: files/{{ item }}
#      dest: /etc/my.cnf.d/
#      owner: root
#      group: root
#      mode: '0775'



  - name: Copy my.cnf
    template:
      src: my.cnf.j2
      dest: /etc/my.cnf
      owner: root
      group: root
      mode: '0600'


  - name: start mysql
    systemd:
      name: mysql
      state: started
      enabled: yes


  - name: 
    raw: cat /var/log/mysqld.log | grep 'root@localhost:' | awk '{print $11}'
    register: current_password
        
#  - debug:
#      msg:
#      - "{{ current_password.stdout_lines }}"


#  - name: Set mysql password
#    raw:  mysql --connect-expired-password -uroot -p"{{ current_password.stdout }}" -e 'ALTER USER USER() IDENTIFIED BY "ei7veeChu4&&Z"'
#    ignore_errors: yes
 

   
  - mysql_user:
      name: bob
      password: 12345
      priv: '*.*:ALL'
      state: present 
    
    
    
    
    
    
    
    
